<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LunarisX Cost Tool</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            color: #c9d1d9;
            min-height: 10vh;
            
            /* --- CUSTOM BACKGROUND IMAGE --- */
            background-image: url('https://i.postimg.cc/0Q0DmQmj/lunarisx-logo-description-background-a-deep-space-bla.jpg'); 
            background-size: cover;
            background-attachment: fixed; 
            background-position: center;
            background-color: #0d1117; 
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        /* Adjust background colors for content boxes */
        .bg-gray-800 {
            background-color: rgba(31, 41, 55, 0.9); 
            backdrop-filter: blur(2px); 
        }
        .bg-gray-700, .bg-gray-700\/50, .modal-content {
            background-color: rgba(55, 65, 81, 0.95) !important; 
        }

        /* Custom modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #374151;
            width: 90%;
            max-width: 600px; /* Increased max width for code sample */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }
        /* Fixed button style */
        #sourceButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 990;
            cursor: pointer;
            padding: 10px 15px;
            font-size: 14px;
            font-weight: bold;
            background-color: #3b82f6; 
            color: white;
            border-radius: 9999px; 
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: background-color 0.2s;
        }
        #sourceButton:hover {
            background-color: #2563eb; 
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- HEADER WITH EXAMPLE BUTTON -->
        <div class="flex items-center justify-between mb-6 border-b border-gray-700 pb-2">
            <h1 class="text-3xl font-bold text-green-400">
                LunarisX Cost Tool
            </h1>
            <button id="exampleButton" onclick="openExampleModal()" class="px-3 py-1 bg-purple-600 hover:bg-purple-700 rounded-lg text-white font-bold transition duration-200 flex items-center shadow-md shadow-purple-900/50">
                <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.523 5.754 18 7.5 18s3.332.477 4.5 1.247m0-13C13.168 5.477 14.754 5 16.5 5s3.332.477 4.5 1.253v13C19.832 18.523 18.246 18 16.5 18s-3.332.477-4.5 1.247"></path></svg>
                Example Strat
            </button>
        </div>
        
        <p class="text-gray-400 mb-6">
            This tool tracks Tower placement order (Index) and **automatically calculates the current upgrade level** to replace cost placeholders with real game costs.
            <br>
            **Supported cost formats:**
            <ul class="list-disc list-inside ml-4 mt-2 text-sm text-gray-300">
                <li>Place: `placeTower(pos, "TowerName", cost)`</li>
                <li>Upgrade (New simplified): `upgradeTower(<span class="text-red-400">INDEX</span>)`</li>
                <li>Upgrade (Legacy): `upgradeTower(<span class="text-red-400">INDEX</span>, cost)`</li>
            </ul>
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

            <!-- Column 1: Input and Settings -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-yellow-400">üìù Input & Settings</h2>

                <!-- Hardcore Mode Toggle -->
                <div class="flex items-center justify-between mb-4 p-3 bg-gray-700 rounded-lg border border-red-500/50">
                    <label for="hardcoreMode" class="text-lg font-bold text-red-400 flex items-center">
                        <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        Hardcore Mode
                    </label>
                    <input type="checkbox" id="hardcoreMode" class="w-5 h-5 text-red-600 bg-gray-900 border-gray-300 rounded focus:ring-red-500">
                </div>
                
                <label for="inputCode" class="block text-sm font-medium mb-1 text-gray-300">Paste your code (example):</label>
                <!-- Updated placeholder to reflect new input format -->
                <textarea id="inputCode" rows="6" placeholder='placeTower(Vec3, "Scout", cost) -- Index 1
placeTower(Vec3, "Sniper", "cost") -- Index 2
upgradeTower(1) -- Scout Lvl 1 (New format)
upgradeTower(1) -- Scout Lvl 2
upgradeTower(2, cost) -- Sniper Lvl 1 (Legacy format)' class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 text-white focus:ring-green-500 focus:border-green-500 mb-4"></textarea>

                <button id="processButton" class="w-full py-3 px-4 bg-green-600 hover:bg-green-700 rounded-lg text-white font-bold transition duration-200 shadow-md shadow-green-900/50">
                    üîç Lookup & Replace Costs
                </button>
                
                <!-- NEW: Duplication Tool -->
                <div class="mt-6 p-4 bg-gray-700 rounded-lg border border-yellow-500/50">
                    <h3 class="text-lg font-semibold mb-3 text-yellow-300">‚ö° Duplication Tool</h3>
                    <div class="flex space-x-3 mb-3">
                        <div class="flex-1">
                            <label for="indexInput" class="block text-xs font-medium text-gray-400">Index (Tower #):</label>
                            <input type="number" id="indexInput" min="1" placeholder="1" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-yellow-500 focus:border-yellow-500" value="1">
                        </div>
                        <div class="flex-1">
                            <label for="dupInput" class="block text-xs font-medium text-gray-400">Dup (Repeat Count):</label>
                            <!-- DEFAULT IS 1 -->
                            <input type="number" id="dupInput" min="1" placeholder="1" class="w-full p-2 rounded-lg bg-gray-600 border border-gray-500 text-white focus:ring-yellow-500 focus:border-yellow-500" value="1">
                        </div>
                    </div>
                    <button id="duplicateButton" class="w-full py-2 px-4 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white font-bold transition duration-200">
                        ‚ûï Execute (Add Upgrades)
                    </button>
                    <p id="duplicateMessage" class="mt-2 text-xs text-red-400 hidden">
                        <span class="font-bold">Error:</span> Index and Dup must be positive numbers.
                    </p>
                </div>
            </div>

            <!-- Column 2: Results -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-blue-400">üí° Results (Modified Code)</h2>
                    <button id="copyButton" onclick="copyOutput()" class="px-3 py-1 text-xs bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition duration-200">
                        Copy All
                    </button>
                </div>
                
                <div id="outputContainer" class="p-4 bg-gray-700 rounded-lg border border-gray-600 min-h-[16rem]">
                    <pre id="outputText" class="text-sm text-gray-200">Paste your code on the left and press the button to see the result.</pre>
                </div>
            </div>
        </div>

        <!-- Tower Placement Cost Table -->
        <div class="mt-8">
            <h2 class="text-xl font-semibold mb-3 text-red-400">‚ö†Ô∏è Tower Placement Costs (Click Tower Name for Upgrade Details)</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full text-sm rounded-lg overflow-hidden bg-gray-800">
                    <thead>
                        <tr class="bg-gray-700 text-red-300">
                            <th class="p-2 text-left">Tower</th>
                            <th class="p-2 text-right">Normal Cost</th>
                            <th class="p-2 text-right">Hardcore Cost (x1.5)</th>
                        </tr>
                    </thead>
                    <tbody id="costTableBody">
                        <!-- Data populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Floating Source Button -->
    <div id="sourceButton" onclick="openSourceModal()">
        Source Info
    </div>

    <!-- Modal for Upgrade Costs -->
    <div id="upgradeModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-2 border-gray-600 mb-4">
                <h3 id="modalTitle" class="text-xl font-bold text-yellow-400">Tower Upgrade Costs</h3>
                <button onclick="closeModal('upgradeModal')" class="text-gray-400 hover:text-white text-2xl font-bold leading-none">&times;</button>
            </div>
            <table class="min-w-full text-sm rounded-lg overflow-hidden bg-gray-800">
                <thead>
                    <tr class="bg-gray-700 text-red-300">
                        <th class="p-2 text-left">Level</th>
                        <th class="p-2 text-right">Normal Cost</th>
                        <th class="p-2 text-right">Hardcore Cost</th>
                    </tr>
                </thead>
                <tbody id="modalTableBody">
                    <!-- Upgrade data goes here -->
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- NEW Modal for Example Strat -->
    <div id="exampleModal" class="modal">
        <div class="modal-content max-w-2xl">
            <div class="flex justify-between items-center border-b pb-2 border-gray-600 mb-4">
                <h3 class="text-xl font-bold text-purple-400">üçï Lvl 1 Tower Placement Example</h3>
                <button onclick="closeModal('exampleModal')" class="text-gray-400 hover:text-white text-2xl font-bold leading-none">&times;</button>
            </div>
            <p class="text-gray-300 mb-4">
                This example shows the placement and first upgrade (Lvl 1) for 25 towers.
            </p>
            <button onclick="loadExample(); closeModal('exampleModal');" class="w-full py-2 mb-4 px-4 bg-green-600 hover:bg-green-700 rounded-lg text-white font-bold transition duration-200">
                Load this Example Code to Input Box
            </button>
            <div class="bg-gray-900 p-3 rounded-lg overflow-x-auto max-h-96">
                <pre id="exampleCodeText" class="text-xs text-gray-300"></pre>
            </div>
        </div>
    </div>

    <!-- Modal for Source Info -->
    <div id="sourceModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center border-b pb-2 border-gray-600 mb-4">
                <h3 class="text-xl font-bold text-blue-400">Source Information</h3>
                <button onclick="closeModal('sourceModal')" class="text-gray-400 hover:text-white text-2xl font-bold leading-none">&times;</button>
            </div>
            <p class="text-gray-300 mb-4">This cost replacer tool was created by LunarisX Hub.</p>
            <p class="text-gray-300">
                Join Discord:
                <a href="#" class="text-blue-400 hover:underline font-semibold" onclick="return false;">https://discord.gg/qfENYnhg</a>
            </p>
        </div>
    </div>


    <script>
        // --- TOWER COST DATA ---
        const TOWER_COSTS = {
            "Scout": { "Place": 150, "Upgrade 1": 50, "Upgrade 2": 200, "Upgrade 3": 950, "Upgrade 4": 2500 },
            "Sniper": { "Place": 300, "Upgrade 1": 150, "Upgrade 2": 500, "Upgrade 3": 1500, "Upgrade 4": 4000 },
            "Paintballer": { "Place": 400, "Upgrade 1": 200, "Upgrade 2": 675, "Upgrade 3": 1000, "Upgrade 4": 2250, "Upgrade 5": 4000 },
            "Demoman": { "Place": 575, "Upgrade 1": 150, "Upgrade 2": 475, "Upgrade 3": 1650, "Upgrade 4": 6250 },
            "Hunter": { "Place": 750, "Upgrade 1": 200, "Upgrade 2": 800, "Upgrade 3": 3250, "Upgrade 4": 9400 },
            "Soldier": { "Place": 350, "Upgrade 1": 100, "Upgrade 2": 400, "Upgrade 3": 1500, "Upgrade 4": 4750 },
            "Militant": { "Place": 700, "Upgrade 1": 200, "Upgrade 2": 900, "Upgrade 3": 2750, "Upgrade 4": 9000 },
            "Freezer": { "Place": 425, "Upgrade 1": 225, "Upgrade 2": 650, "Upgrade 3": 2000, "Upgrade 4": 4500 },
            "Assassin": { "Place": 200, "Upgrade 1": 250, "Upgrade 2": 1000, "Upgrade 3": 2750, "Upgrade 4": 7600 },
            "Shotgunner": { "Place": 300, "Upgrade 1": 150, "Upgrade 2": 950, "Upgrade 3": 2500, "Upgrade 4": 6500 },
            "Pyromancer": { "Place": 850, "Upgrade 1": 350, "Upgrade 2": 950, "Upgrade 3": 1500, "Upgrade 4": 3800, "Upgrade 5": 9000 },
            "Ace Pilot": { "Place": 550, "Upgrade 1": 200, "Upgrade 2": 350, "Upgrade 3": 1850, "Upgrade 4": 3200, "Upgrade 5": 8000 },
            "Medic": { "Place": 500, "Upgrade 1": 500, "Upgrade 2": 750, "Upgrade 3": 2700, "Upgrade 4": 6000, "Upgrade 5": 16000 },
            "Farm": { "Place": 250, "Upgrade 1": 200, "Upgrade 2": 550, "Upgrade 3": 1000, "Upgrade 4": 2500, "Upgrade 5": 5000 },
            "Rocketeer": { "Place": 1500, "Upgrade 1": 250, "Upgrade 2": 1750, "Upgrade 3": 6500, "Upgrade 4": 20000 },
            "Trapper": { "Place": 500, "Upgrade 1": 500, "Upgrade 2": 1500, "Upgrade 3": 5000, "Upgrade 4": 13500 },
            "Military Base": { "Place": 400, "Upgrade 1": 200, "Upgrade 2": 400, "Upgrade 3": 1750, "Upgrade 4": 7500, "Upgrade 5": 25000 },
            "Crook Boss": { "Place": 600, "Upgrade 1": 300, "Upgrade 2": 900, "Upgrade 3": 4250, "Upgrade 4": 20000 },
            "Electroshocker": { "Place": 725, "Upgrade 1": 300, "Upgrade 2": 600, "Upgrade 3": 2000, "Upgrade 4": 5000, "Upgrade 5": 15000 },
            "Commander": { "Place": 850, "Upgrade 1": 300, "Upgrade 2": 2500, "Upgrade 3": 5500, "Upgrade 4": 15000 },
            "Warden": { "Place": 1000, "Upgrade 1": 400, "Upgrade 2": 1250, "Upgrade 3": 4500, "Upgrade 4": 15000 },
            "Cowboy": { "Place": 500, "Upgrade 1": 150, "Upgrade 2": 550, "Upgrade 3": 1500, "Upgrade 4": 3000, "Upgrade 5": 5250 },
            "DJ Booth": { "Place": 1200, "Upgrade 1": 300, "Upgrade 2": 1250, "Upgrade 3": 3000, "Upgrade 4": 8000, "Upgrade 5": 20000 },
            "Minigunner": { "Place": 1850, "Upgrade 1": 400, "Upgrade 2": 1500, "Upgrade 3": 7000, "Upgrade 4": 17500 },
            "Ranger": { "Place": 4500, "Upgrade 1": 1500, "Upgrade 2": 4500, "Upgrade 3": 13500, "Upgrade 4": 30000 },
            "Pursuit": { "Place": 3000, "Upgrade 1": 1200, "Upgrade 2": 1850, "Upgrade 3": 5000 },
            "Gatling Gun": { "Place": 5250, "Upgrade 1": 3000, "Upgrade 2": 7500, "Upgrade 3": 15000, "Upgrade 4": 32500, "Upgrade 5": 50000, "Upgrade 6": 100000 },
            "Turret": { "Place": 5000, "Upgrade 1": 1250, "Upgrade 2": 7250, "Upgrade 3": 15000, "Upgrade 4": 30000, "Upgrade 5": 52500 },
            "Mortar": { "Place": 900, "Upgrade 1": 325, "Upgrade 2": 1400, "Upgrade 3": 3250, "Upgrade 4": 12000, "Upgrade 5": 25000 },
            "Mercenary Base": { "Place": 2000, "Upgrade 1": 1000, "Upgrade 2": 2000, "Upgrade 3": 7000, "Upgrade 4": 10000, "Upgrade 5": 15000, "Upgrade 6": 35000 },
            "Brawler": { "Place": 600, "Upgrade 1": 300, "Upgrade 2": 850, "Upgrade 3": 2000, "Upgrade 4": 5000, "Upgrade 5": 12500 },
            "Necromancer": { "Place": 1650, "Upgrade 1": 1150, "Upgrade 2": 3950, "Upgrade 3": 11320, "Upgrade 4": 44000 },
            "Accelerator": { "Place": 4500, "Upgrade 1": 1000, "Upgrade 2": 2500, "Upgrade 3": 4750, "Upgrade 4": 11250, "Upgrade 5": 36000 },
            "Engineer": { "Place": 600, "Upgrade 1": 350, "Upgrade 2": 550, "Upgrade 3": 2250, "Upgrade 4": 4750, "Upgrade 5": 13500, "Upgrade 6": 35000 },
            "Hacker": { "Place": 1400, "Upgrade 1": 600, "Upgrade 2": 1250, "Upgrade 3": 7500, "Upgrade 4": 22000 }
        };

        // Stores the tower name mapped to its placement index (1-based)
        let towerIndexMap = {}; 
        
        let outputTextElement;
        let processButton;
        let hardcoreModeCheckbox;
        let inputCodeTextarea;
        let costTableBody;
        let modalTableBody;
        let modalTitle;
        let indexInput;
        let dupInput;
        let duplicateMessage;

        // --- UPDATED EXAMPLE CODE (Cleaned comments) ---
        const EXAMPLE_CODE = `placeTower(Vector3.new(7.75418, 1.03687, -24.25305), "Electroshocker", cost)
upgradeTower(1, cost)
placeTower(Vector3.new(-0.67019, 1.03687, -15.90981), "Rocketeer", cost)
upgradeTower(2, cost)
placeTower(Vector3.new(-0.61207, 1.03687, -12.83725), "Rocketeer", cost)
upgradeTower(3, cost)
placeTower(Vector3.new(-0.71965, 1.03687, -9.75270), "Rocketeer", cost)
upgradeTower(4, cost)
placeTower(Vector3.new(-0.65521, 1.03687, -6.62865), "Rocketeer", cost)
upgradeTower(5, cost)
placeTower(Vector3.new(2.23264, 1.03687, -8.15452), "Rocketeer", cost)
upgradeTower(6, cost)
placeTower(Vector3.new(2.22419, 1.03687, -11.23436), "Rocketeer", cost)
upgradeTower(7, cost)
placeTower(Vector3.new(2.39913, 1.03687, -14.38913), "Rocketeer", cost)
upgradeTower(8, cost)
placeTower(Vector3.new(2.20887, 1.03687, -17.44070), "Rocketeer", cost)
upgradeTower(9, cost)
placeTower(Vector3.new(-3.49797, 1.03687, -11.25871), "Commander", cost)
upgradeTower(10, cost)
placeTower(Vector3.new(-3.41905, 1.03687, -14.32773), "Commander", cost)
upgradeTower(11, cost)
placeTower(Vector3.new(-3.41586, 1.03687, -8.00747), "Commander", cost)
upgradeTower(12, cost)
placeTower(Vector3.new(-6.69524, 4.00740, -11.66319), "Ranger", cost)
upgradeTower(13, cost)
placeTower(Vector3.new(-4.99089, 4.00740, -8.99515), "Ranger", cost)
upgradeTower(14, cost)
placeTower(Vector3.new(-4.75861, 7.00740, -7.64855), "Ranger", cost)
upgradeTower(15, cost)
placeTower(Vector3.new(5.63877, 1.03687, -12.49786), "Electroshocker", cost)
upgradeTower(16, cost)
placeTower(Vector3.new(2.07390, 1.03687, -4.95058), "Electroshocker", cost)
upgradeTower(17, cost)
placeTower(Vector3.new(-4.82573, 7.00740, -4.58934), "Ranger", cost)
upgradeTower(18, cost)
placeTower(Vector3.new(-7.91268, 7.00740, -7.74334), "Ranger", cost)
upgradeTower(19, cost)
placeTower(Vector3.new(-8.00030, 7.00740, -4.70122), "Ranger", cost)
upgradeTower(20, cost)
placeTower(Vector3.new(-10.71475, 7.00740, -6.19627), "Ranger", cost)
upgradeTower(21, cost)
placeTower(Vector3.new(2.15463, 1.03687, -25.42523), "Commander", cost)
upgradeTower(22, cost)
placeTower(Vector3.new(-1.06437, 1.03687, -3.10217), "Turret", cost)
upgradeTower(23, cost)
placeTower(Vector3.new(-5.22454, 1.03687, -2.68031), "Turret", cost)
upgradeTower(24, cost)
placeTower(Vector3.new(-9.
